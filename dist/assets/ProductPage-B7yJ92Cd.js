import{c as U,u as T,r as d,s as f,a as u,j as e,f as O,b as L,d as W,e as H,A as I,T as F,F as Q,C as G}from"./index-CsEdGDVt.js";import{D as J}from"./download-DhAs3AIt.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=U("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),B=({filled:l})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:l?"#FBBF24":"none",stroke:"#FBBF24",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:e.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})});function X({productId:l}){const{user:n}=T(),[x,b]=d.useState([]),[t,_]=d.useState(!0),[v,R]=d.useState(!1),[N,g]=d.useState(!1),[m,y]=d.useState({rating:5,comment:""});d.useEffect(()=>{k(),n&&$()},[l,n]);const k=async()=>{try{const{data:s,error:i}=await f.from("reviews").select("*").eq("product_id",l).eq("approved",!0).order("created_at",{ascending:!1});if(i)throw i;if(b(s||[]),n){const{data:j}=await f.from("reviews").select("*").eq("product_id",l).eq("user_id",n.id).maybeSingle();g(!!j)}}catch(s){console.error("Error loading reviews:",s),u.error("Error al cargar las reseñas")}finally{_(!1)}},$=async()=>{if(n)try{const{data:s,error:i}=await f.from("orders").select(`
          id,
          order_items!inner (
            product_id
          )
        `).eq("user_id",n.id).eq("status","delivered").eq("order_items.product_id",l);if(i)throw i;R(s&&s.length>0)}catch(s){console.error("Error checking if user can review:",s)}},c=async s=>{if(s.preventDefault(),!(!n||!v))try{const{error:i}=await f.from("reviews").insert({product_id:l,user_id:n.id,Name:n.full_name||"Usuario",rating:m.rating,comment:m.comment,approved:!1});if(i)throw i;u.success("Tu reseña ha sido enviada y está pendiente de aprobación"),g(!0),y({rating:5,comment:""})}catch(i){console.error("Error submitting review:",i),u.error("Error al enviar la reseña")}},h=s=>{if(s==null)return 0;const i=typeof s=="string"?parseFloat(s):Number(s);return isNaN(i)?0:Math.min(Math.max(i,0),5)},C=x.length>0?x.reduce((s,i)=>s+h(i.rating),0)/x.length:0,q=s=>{const i=h(s),j=Math.min(Math.max(i,0),5);return e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(p=>e.jsx(B,{filled:p<=j},p))})};return t?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]}):e.jsxs("div",{className:"mt-8",id:"reviews",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Opiniones de clientes"}),x.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex items-center",children:q(C)}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[h(C).toFixed(1)," de 5 (",x.length," opiniones)"]})]}),e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"flex items-center",children:q(s.rating)}),e.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-900",children:[s.Name||""," "]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:s.comment}),e.jsx("p",{className:"text-xs text-gray-500",children:O(new Date(s.created_at),"dd/MM/yyyy")})]},s.id))})]}):e.jsx("p",{className:"text-gray-500",children:"Este producto aún no tiene reseñas."}),n&&!N&&v&&e.jsxs("div",{className:"mt-8 border-t border-gray-200 pt-8",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deja tu opinión"}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Calificación"}),e.jsx("div",{className:"flex items-center",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>y(i=>({...i,rating:s})),className:"p-1 focus:outline-none",children:e.jsx(B,{filled:s<=m.rating})},s))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700 mb-1",children:"Comentario"}),e.jsx("textarea",{id:"comment",rows:3,value:m.comment,onChange:s=>y(i=>({...i,comment:s.target.value})),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",required:!0})]}),e.jsx("button",{type:"submit",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Enviar reseña"})]})]}),n&&!v&&!N&&e.jsx("div",{className:"mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"Solo los clientes que han comprado este producto pueden dejar una reseña."})})]})}),!n&&e.jsx("div",{className:"mt-4 bg-gray-50 border border-gray-200 rounded-md p-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Debes iniciar sesión para poder dejar una reseña."," ",e.jsx("a",{href:"/auth",className:"text-indigo-600 hover:text-indigo-500",children:"Iniciar sesión"})]})})]})}function Y(){var P;const{id:l}=L(),n=W(),x=H(),{user:b}=T(),[t,_]=d.useState(null),[v,R]=d.useState(!0),[N,g]=d.useState(""),[m,y]=d.useState(""),[k,$]=d.useState([]),[c,h]=d.useState(1);d.useEffect(()=>{C()},[l]);const C=async()=>{var r,o;try{if(!l)return;const{data:a,error:D}=await f.from("products").select("*").eq("id",l).single();if(D)throw D;if(_(a),((r=a==null?void 0:a.images)==null?void 0:r.length)>0&&g(a.images[0]),((o=a==null?void 0:a.available_colors)==null?void 0:o.length)>0){const w=a.available_colors[0];if(y(w),a.color_images&&a.color_images.length>0){const E=a.color_images.find(A=>A.color===w);E&&E.image&&g(E.image)}}const{data:S,error:V}=await f.from("promotion_products").select(`
          promotion:promotions(
            id, name, type, buy_quantity, get_quantity, total_price, active, 
            start_date, end_date, created_at, updated_at
          )
        `).eq("product_id",l).filter("promotion.active","eq",!0).filter("promotion.start_date","lte",new Date().toISOString()).filter("promotion.end_date","gte",new Date().toISOString()).maybeSingle();!V&&(S!=null&&S.promotion)&&_(w=>w?{...w,promotion:S.promotion}:null);const{data:M,error:z}=await f.from("products").select("*").neq("id",l).eq("category",a.category).limit(4);!z&&M&&$(M)}catch(a){console.error("Error loading product:",a),u.error("Error al cargar el producto"),n("/")}finally{R(!1)}},q=async()=>{const r=window.location.href;try{await navigator.clipboard.writeText(r),u.success("Enlace copiado al portapapeles")}catch{u.error("Error al copiar el enlace")}},s=r=>{var a;if(r.preventDefault(),!t)return;if((a=t.available_colors)!=null&&a.length&&!m){u.error("Por favor selecciona un color");return}const o=t.promotion?{...t,promotion:t.promotion}:t;x.addItem(o,c,m),u.success(e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"¡Producto agregado al carrito!"}),e.jsxs("p",{className:"text-sm",children:[c," ",c>1?"unidades":"unidad"," de ",t.name,m&&` (${m})`]})]})}),{duration:3e3,position:"top-center",style:{background:"#4F46E5",color:"#ffffff",padding:"1rem",borderRadius:"0.5rem"}}),x.toggleCart()},i=r=>{var a;if(r.preventDefault(),!t)return;if((a=t.available_colors)!=null&&a.length&&!m){u.error("Por favor selecciona un color");return}const o=t.promotion?{...t,promotion:t.promotion}:t;x.clearCart(),x.addItem(o,c,m),n("/checkout")},j=()=>{if(!t||!t.promotion)return null;if(t.promotion.total_price)return t.promotion.total_price;if(t.promotion.type==="discount"){const o=(100-(t.promotion.discount_percent||20))/100;return(t.price*o).toFixed(2)}if(["2x1","3x1","3x2"].includes(t.promotion.type)&&c>=t.promotion.buy_quantity){const r=Math.floor(c/t.promotion.buy_quantity),o=c%t.promotion.buy_quantity;return((r*t.promotion.get_quantity+o)*t.price).toFixed(2)}return(c*t.price).toFixed(2)},p=()=>t?(c*t.price).toFixed(2):null;return v?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})}):t?e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("button",{onClick:()=>n("/"),className:"mb-8 inline-flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(I,{className:"h-5 w-5 mr-2"}),"Volver"]}),e.jsxs("div",{className:"lg:grid lg:grid-cols-2 lg:gap-x-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-w-3 aspect-h-4 rounded-lg overflow-hidden",children:e.jsx("img",{src:N||((P=t.images)==null?void 0:P[0]),alt:t.name,className:"w-full h-full object-center object-cover"})}),t.images&&t.images.length>1&&e.jsx("div",{className:"grid grid-cols-4 gap-4",children:t.images.map((r,o)=>e.jsx("button",{onClick:()=>g(r),className:`aspect-w-1 aspect-h-1 rounded-lg overflow-hidden ${N===r?"ring-2 ring-indigo-500":""}`,children:e.jsx("img",{src:r,alt:`${t.name} - Vista ${o+1}`,className:"w-full h-full object-center object-cover"})},o))})]}),e.jsxs("div",{className:"mt-10 px-4 sm:px-0 sm:mt-16 lg:mt-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight text-gray-900",children:t.name}),(b==null?void 0:b.role)==="admin"&&e.jsxs("button",{onClick:q,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Compartir"]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h2",{className:"sr-only",children:"Información del producto"}),e.jsx("div",{className:"flex items-center",children:t.promotion?e.jsx(e.Fragment,{children:t.promotion.type==="discount"?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("p",{className:"text-2xl text-gray-500 line-through mr-2",children:["$",p()]}),e.jsxs("p",{className:"text-3xl font-bold text-red-600",children:["$",j()]})]}),e.jsxs("div",{className:"mt-1 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),t.promotion.discount_percent||20,"% de descuento"]})]}):e.jsx("div",{className:"flex flex-col",children:c>=t.promotion.buy_quantity?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("p",{className:"text-2xl text-gray-500 line-through mr-2",children:["$",p()]}),e.jsxs("p",{className:"text-3xl font-bold text-red-600",children:["$",j()]})]}),e.jsxs("div",{className:"mt-1 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),t.promotion.type==="2x1"&&"Compra 2, paga 1",t.promotion.type==="3x1"&&"Compra 3, paga 1",t.promotion.type==="3x2"&&"Compra 3, paga 2"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-3xl text-gray-900",children:["$",p()]}),e.jsxs("div",{className:"mt-1 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),t.promotion.type==="2x1"&&`¡Compra ${t.promotion.buy_quantity} y paga ${t.promotion.get_quantity}!`,t.promotion.type==="3x1"&&`¡Compra ${t.promotion.buy_quantity} y paga ${t.promotion.get_quantity}!`,t.promotion.type==="3x2"&&`¡Compra ${t.promotion.buy_quantity} y paga ${t.promotion.get_quantity}!`]})]})})}):e.jsxs("p",{className:"text-3xl text-gray-900",children:["$",p()]})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"sr-only",children:"Descripción"}),e.jsx("div",{className:"text-base text-gray-700 space-y-6",children:t.description})]}),t.available_colors&&t.available_colors.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Colores disponibles"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.available_colors.map(r=>e.jsx("button",{onClick:()=>{if(y(r),t.color_images&&t.color_images.length>0){const o=t.color_images.find(a=>a.color===r);o&&o.image&&g(o.image)}},className:`px-3 py-1 rounded-full text-sm ${m===r?"bg-indigo-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:r},r))})]}),t.instructions_file&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Q,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Manual del producto disponible"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Descarga las instrucciones de uso y documentación del producto"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("a",{href:t.instructions_file,download:`manual-${t.name}.pdf`,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Descargar"]})})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-200",children:e.jsx("a",{href:t.instructions_file,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-500 underline",children:"Ver manual en línea"})})]}),t.show_delivery_time&&t.delivery_time&&e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-700",children:[e.jsx(G,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsxs("span",{children:["Tiempo estimado de entrega: ",t.delivery_time]})]})}),e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"text-sm text-gray-700",children:["Stock disponible: ",t.stock]})})}),e.jsxs("div",{className:"mt-10 flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"quantity",className:"mr-3 text-sm font-medium text-gray-700",children:"Cantidad:"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md",children:[e.jsx("button",{type:"button",className:"px-3 py-1 text-gray-600 hover:text-gray-900 focus:outline-none",onClick:()=>h(Math.max(1,c-1)),children:"-"}),e.jsx("input",{type:"number",id:"quantity",name:"quantity",min:"1",max:t.stock,value:c,onChange:r=>h(Math.min(t.stock,Math.max(1,parseInt(r.target.value)||1))),className:"w-12 text-center border-0 focus:ring-0"}),e.jsx("button",{type:"button",className:"px-3 py-1 text-gray-600 hover:text-gray-900 focus:outline-none",onClick:()=>h(Math.min(t.stock,c+1)),children:"+"})]})]}),e.jsxs("div",{className:"flex sm:flex-row gap-4",children:[e.jsx("button",{onClick:s,disabled:t.stock===0,className:"flex-1 bg-indigo-600 border border-transparent rounded-md py-3 px-8 flex items-center justify-center text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-50 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Agregar al carrito"}),e.jsx("button",{onClick:i,disabled:t.stock===0,className:"flex-1 bg-indigo-100 border border-transparent rounded-md py-3 px-8 flex items-center justify-center text-base font-medium text-indigo-700 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-50 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Comprar ahora"})]})]}),t.category&&e.jsx("div",{className:"mt-6",children:e.jsxs("div",{className:"text-sm text-gray-700",children:["Categoría: ",t.category]})})]})]}),e.jsx("div",{className:"mt-16 border-t border-gray-200 pt-8",children:e.jsx(X,{productId:t.id})}),k.length>0&&e.jsxs("div",{className:"mt-16 border-t border-gray-200 pt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Productos relacionados"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:k.map(r=>{var o;return e.jsxs("div",{onClick:()=>n(`/products/${r.id}`),className:"group relative cursor-pointer",children:[e.jsx("div",{className:"aspect-w-1 aspect-h-1 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:(o=r.images)==null?void 0:o[0],alt:r.name,className:"object-center object-cover group-hover:opacity-75 transition-opacity"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["$",r.price]})]})]},r.id)})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Producto no encontrado"}),e.jsxs("button",{onClick:()=>n("/"),className:"mt-4 inline-flex items-center text-indigo-600 hover:text-indigo-500",children:[e.jsx(I,{className:"h-5 w-5 mr-2"}),"Volver al inicio"]})]})})}function te(){const{id:l}=L();return l?e.jsx(Y,{}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Producto no encontrado"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"No se ha especificado un ID de producto válido."}),e.jsx("a",{href:"/",className:"mt-4 inline-block text-indigo-600 hover:text-indigo-500",children:"Volver al inicio"})]})})}export{te as default};
