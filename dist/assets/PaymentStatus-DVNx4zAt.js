import{t as j,d as C,e as S,r as A,j as t,A as k,s as P,C as E}from"./index-CsEdGDVt.js";import{X as _,C as T}from"./x-circle-BKgiUukI.js";function L(){const[l]=j(),o=C(),a=l.get("status"),r=l.get("order_id"),m=S(s=>s.clearCart);A.useEffect(()=>{(async()=>{var n,u,g,p,h,y,f,x,v;if(a==="approved"&&r){console.log("[PaymentStatus] Payment approved for orderId:",r);try{const{data:e,error:c}=await P.from("orders").select(`
              id,
              guest_info,
              shipping_address,
              payment_method,
              total,
              order_items (
                quantity,
                price_at_time,
                selected_color,
                products (name, price)
              )
            `).eq("id",r).single();if(c||!e)console.error("[PaymentStatus] Error fetching order details for notification:",c==null?void 0:c.message);else{console.log("[PaymentStatus] Order details fetched:",e);const N={fullName:((n=e.shipping_address)==null?void 0:n.full_name)||((u=e.guest_info)==null?void 0:u.full_name)||"N/A",email:((g=e.guest_info)==null?void 0:g.email)||"N/A",phone:((p=e.shipping_address)==null?void 0:p.phone)||((h=e.guest_info)==null?void 0:h.phone)||"N/A",address:((y=e.shipping_address)==null?void 0:y.address)||"N/A",city:((f=e.shipping_address)==null?void 0:f.city)||"N/A",postalCode:((x=e.shipping_address)==null?void 0:x.postal_code)||"N/A",country:((v=e.shipping_address)==null?void 0:v.country)||"N/A",orderId:e.id,paymentMethod:e.payment_method,totalAmount:Number(e.total).toFixed(2),items:e.order_items.map(d=>({product:{name:d.products.name,price:Number(d.products.price)},quantity:d.quantity,selectedColor:d.selected_color||"N/A"}))};console.log("[PaymentStatus] Attempting to send notification email for approved order:",N);const{error:b}=await P.functions.invoke("send-order-notification",{body:{orderData:N}});b?console.error("[PaymentStatus] Error sending approved order notification email:",b.message):console.log("[PaymentStatus] Approved order notification email function invoked.")}m(),sessionStorage.removeItem("checkout-form-bolt-v3"),console.log("[PaymentStatus] Cart and form data cleared for successful payment.")}catch(e){console.error("[PaymentStatus] Exception during successful payment handling:",e.message)}const w=setTimeout(()=>{o("/")},5e3);return()=>clearTimeout(w)}})()},[a,r,o,m]);const i=(()=>{switch(a){case"approved":return{icon:t.jsx(T,{className:"h-16 w-16 text-green-500"}),title:"¡Pago exitoso!",message:"Tu pago ha sido procesado correctamente. Hemos enviado una notificación a tu correo y serás redirigido al inicio en 5 segundos.",actions:[{text:"Volver al inicio ahora",action:()=>o("/"),style:"bg-green-600 hover:bg-green-700 text-white",isPrimary:!0}]};case"rejected":return{icon:t.jsx(_,{className:"h-16 w-16 text-red-500"}),title:"Pago rechazado",message:"Lo sentimos, tu pago no pudo ser procesado. Por favor intenta de nuevo.",actions:[{text:"Elegir otro medio de pago",action:()=>o("/checkout"),style:"bg-red-600 hover:bg-red-700 text-white",isPrimary:!0},{text:"Volver al inicio",action:()=>o("/"),style:"bg-gray-200 hover:bg-gray-300 text-gray-700",isPrimary:!1}]};case"pending_cod":case"pending":return{icon:t.jsx(E,{className:"h-16 w-16 text-yellow-500"}),title:"Pago pendiente",message:a==="pending_cod"?"Tu pedido contra entrega ha sido recibido y está siendo procesado. Te hemos enviado una notificación por correo.":"Tu pago está siendo procesado. Te notificaremos cuando se confirme.",actions:[{text:"Volver al inicio",action:()=>o("/"),style:"bg-yellow-600 hover:bg-yellow-700 text-white",isPrimary:!0}]};default:return{icon:t.jsx(_,{className:"h-16 w-16 text-gray-500"}),title:"Estado desconocido",message:"No pudimos determinar el estado de tu pago. Contacta a soporte si el problema persiste.",actions:[{text:"Volver al inicio",action:()=>o("/"),style:"bg-gray-600 hover:bg-gray-700 text-white",isPrimary:!0}]}}})();return t.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[t.jsx("div",{className:"flex items-center p-4 border-b bg-white shadow-sm",children:t.jsx("button",{onClick:()=>o("/"),className:"text-gray-600 hover:text-gray-900 focus:outline-none",children:t.jsx(k,{className:"h-6 w-6"})})}),t.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:t.jsxs("div",{className:"max-w-md w-full bg-white shadow rounded-lg p-8 text-center",children:[t.jsx("div",{className:"flex justify-center mb-6",children:i.icon}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:i.title}),t.jsx("p",{className:"text-gray-600 mb-8",children:i.message}),t.jsx("div",{className:"space-y-4",children:i.actions.map((s,n)=>t.jsx("button",{onClick:s.action,className:`w-full py-3 px-4 rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 ${s.style} ${s.isPrimary?"":"border border-gray-300"}`,children:s.text},n))})]})})]})}export{L as PaymentStatus};
