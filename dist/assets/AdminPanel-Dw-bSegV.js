import{c as I,r as c,s as S,a as y,j as e,i as oe,m as F,f as me,C as ze,g as ee,l as He,n as Ce,X as ne,F as ve,o as Pe,p as Ne,q as De,u as Me,k as we,d as Be,t as Ge,P as Ve,T as Xe,v as We}from"./index-CsEdGDVt.js";import{X as le,C as Ke}from"./x-circle-BKgiUukI.js";import{C as Je,u as Ye}from"./useShippingSettings-9QQGwGjK.js";import{D as Ze}from"./download-DhAs3AIt.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=I("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=I("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=I("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=I("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=I("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=I("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=I("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=I("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=I("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=I("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=I("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=I("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),re={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800"},processing:{label:"Procesando",color:"bg-blue-100 text-blue-800"},shipped:{label:"Enviado",color:"bg-purple-100 text-purple-800"},delivered:{label:"Entregado",color:"bg-green-100 text-green-800"},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-800"}},se={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800"},paid:{label:"Pagado",color:"bg-green-100 text-green-800"},failed:{label:"Fallido",color:"bg-red-100 text-red-800"}},_e=()=>{var q,G,V,X,W,J,Y,n,h;const[t,r]=c.useState([]),[s,a]=c.useState(!0),[i,m]=c.useState(null),[p,g]=c.useState(null),[l,j]=c.useState(!1),[u,E]=c.useState(null),[C,x]=c.useState([]),[N,_]=c.useState(!1),[P,d]=c.useState(!1);c.useEffect(()=>{b()},[]);const b=async()=>{try{a(!0),m(null);const{data:o,error:v}=await S.from("orders").select(`
          *,
          order_items (
            id,
            quantity,
            price_at_time,
            selected_color,
            products (
              id,
              name,
              images
            )
          )
        `).order("created_at",{ascending:!1});if(v){console.error("Error loading orders:",v),m("Error loading orders: "+v.message),y.error("Error al cargar los pedidos"),a(!1);return}if(!o||o.length===0){console.log("No orders found"),r([]),a(!1);return}const D=o.map(M=>{var H,K,ye,be,je;const A=((H=M.shipping_address)==null?void 0:H.full_name)||((K=M.guest_info)==null?void 0:K.full_name)||"N/A",R=((ye=M.guest_info)==null?void 0:ye.email)||"N/A",z=((be=M.shipping_address)==null?void 0:be.phone)||((je=M.guest_info)==null?void 0:je.phone)||"N/A";return{...M,customer_name:A,customer_email:R,customer_phone:z,total_amount:M.total}});r(D),x([]),_(!1)}catch(o){console.error("General error loading orders:",o),m("General error: "+o.message),y.error("Error al cargar los pedidos")}finally{a(!1)}},T=async o=>{if(confirm("¿Estás seguro de que quieres eliminar este pedido? Esta acción no se puede deshacer."))try{const{error:v}=await S.from("order_items").delete().eq("order_id",o);if(v)throw v;const{error:D}=await S.from("orders").delete().eq("id",o);if(D)throw D;y.success("Pedido eliminado exitosamente"),b(),(u==null?void 0:u.id)===o&&(j(!1),E(null))}catch(v){console.error("Error deleting order:",v),y.error("Error al eliminar el pedido")}},O=async()=>{if(d(!1),C.length===0){y.error("No hay pedidos seleccionados para eliminar");return}try{a(!0);const{error:o}=await S.from("order_items").delete().in("order_id",C);if(o)throw o;const{error:v}=await S.from("orders").delete().in("id",C);if(v)throw v;y.success(`${C.length} pedidos eliminados exitosamente`),await b()}catch(o){console.error("Error deleting orders:",o),y.error("Error al eliminar los pedidos")}finally{a(!1)}},$=async(o,v)=>{try{const{error:D}=await S.from("orders").update({status:v}).eq("id",o);if(D)throw D;y.success("Estado del pedido actualizado"),b()}catch(D){console.error("Error updating order status:",D),y.error("Error al actualizar el estado del pedido")}},f=async o=>{console.log("Viewing order details:",o.id),E(o),j(!0)},w=o=>{g(p===o?null:o)},L=(o,v)=>{v?x(D=>[...D,o]):(x(D=>D.filter(M=>M!==o)),_(!1))},k=o=>{_(o),x(o?t.map(v=>v.id):[])};return s?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Pedidos"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("button",{onClick:b,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Actualizar"]}),C.length>0&&e.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),"Eliminar seleccionados (",C.length,")"]})]})]}),i&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(le,{className:"h-5 w-5 text-red-400"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:i})})]})}),t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No hay pedidos disponibles."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-2 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:N,onChange:o=>k(o.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pedido"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pago"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(o=>{var v,D,M,A,R,z,H;return e.jsxs(F.Fragment,{children:[e.jsxs("tr",{className:p===o.id?"bg-gray-50":"",children:[e.jsx("td",{className:"px-2 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:C.includes(o.id),onChange:K=>L(o.id,K.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["#",o.id.substring(0,8)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["$",o.total?o.total.toFixed(2):"N/A"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:o.customer_name||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:o.customer_email||"N/A"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${((v=re[o.status])==null?void 0:v.color)||"bg-gray-100 text-gray-800"}`,children:((D=re[o.status])==null?void 0:D.label)||o.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${((M=se[o.payment_status])==null?void 0:M.color)||"bg-gray-100 text-gray-800"}`,children:((A=se[o.payment_status])==null?void 0:A.label)||o.payment_status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.created_at?me(new Date(o.created_at),"dd/MM/yyyy HH:mm"):"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>f(o),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:e.jsx(rt,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>w(o.id),className:"text-gray-600 hover:text-gray-900 mr-3",children:p===o.id?e.jsx(tt,{className:"h-5 w-5"}):e.jsx(et,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>T(o.id),className:"text-red-600 hover:text-red-900",children:e.jsx(oe,{className:"h-5 w-5"})})]})]}),p===o.id&&e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-6 py-4 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-900 mb-2",children:[e.jsx("strong",{children:"Dirección de envío:"})," ",((R=o.shipping_address)==null?void 0:R.address)||"No disponible",", ",((z=o.shipping_address)==null?void 0:z.city)||"",", ",((H=o.shipping_address)==null?void 0:H.country)||""]}),e.jsxs("div",{className:"text-sm text-gray-900 mb-2",children:[e.jsx("strong",{children:"Método de pago:"})," ",o.payment_method==="cash_on_delivery"?"Pago contra entrega":o.payment_method||"No disponible"]}),e.jsxs("div",{className:"text-sm text-gray-900 mb-4",children:[e.jsx("strong",{children:"Notas:"})," ",o.notes||"Sin notas"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>$(o.id,"pending"),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-yellow-700 bg-yellow-100 hover:bg-yellow-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),"Pendiente"]}),e.jsxs("button",{onClick:()=>$(o.id,"processing"),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Je,{className:"h-4 w-4 mr-1"}),"Procesando"]}),e.jsxs("button",{onClick:()=>$(o.id,"shipped"),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-purple-700 bg-purple-100 hover:bg-purple-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Enviado"]}),e.jsxs("button",{onClick:()=>$(o.id,"delivered"),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-green-700 bg-green-100 hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[e.jsx(Ke,{className:"h-4 w-4 mr-1"}),"Entregado"]}),e.jsxs("button",{onClick:()=>$(o.id,"cancelled"),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Cancelado"]})]})]})})]},o.id)})})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Confirmar eliminación"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["¿Estás seguro de que quieres eliminar ",C.length," pedidos? Esta acción no se puede deshacer."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>d(!1),className:"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancelar"}),e.jsxs("button",{onClick:O,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx(oe,{className:"h-5 w-5 mr-2"}),"Eliminar"]})]})]})}),l&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Detalles del Pedido #",u.id.substring(0,8)]}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-500",children:e.jsx(le,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"border-t border-gray-200 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Información del Cliente"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Nombre: ",u.customer_name||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Email: ",u.customer_email||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Teléfono: ",u.customer_phone||"N/A"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Información del Pedido"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Fecha: ",u.created_at?me(new Date(u.created_at),"dd/MM/yyyy HH:mm"):"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Estado: ",e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${((q=re[u.status])==null?void 0:q.color)||"bg-gray-100 text-gray-800"}`,children:((G=re[u.status])==null?void 0:G.label)||u.status})]}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Pago: ",e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${((V=se[u.payment_status])==null?void 0:V.color)||"bg-gray-100 text-gray-800"}`,children:((X=se[u.payment_status])==null?void 0:X.label)||u.payment_status})]})]})]})}),e.jsxs("div",{className:"border-t border-gray-200 py-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Dirección de Envío"}),e.jsxs("p",{className:"text-sm text-gray-900",children:[((W=u.shipping_address)==null?void 0:W.address)||"No disponible",",",((J=u.shipping_address)==null?void 0:J.city)||"",",",((Y=u.shipping_address)==null?void 0:Y.postal_code)||"",",",((n=u.shipping_address)==null?void 0:n.country)||""]})]}),e.jsxs("div",{className:"border-t border-gray-200 py-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Productos"}),u.order_items&&u.order_items.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subtotal"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.order_items.map((o,v)=>{var D,M,A,R;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[((D=o.products)==null?void 0:D.images)&&o.products.images[0]&&e.jsx("div",{className:"flex-shrink-0 h-10 w-10 mr-4",children:e.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:o.products.images[0],alt:((M=o.products)==null?void 0:M.name)||"Producto"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((A=o.products)==null?void 0:A.name)||"Producto desconocido"}),o.selected_color&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Color: ",o.selected_color]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.quantity||1}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",((R=o.price_at_time)==null?void 0:R.toFixed(2))||"N/A"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",((o.price_at_time||0)*(o.quantity||1)).toFixed(2)]})]},v)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"Total:"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["$",((h=u.total)==null?void 0:h.toFixed(2))||"N/A"]})]})})]})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No hay productos disponibles para este pedido."})]}),e.jsxs("div",{className:"border-t border-gray-200 py-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Notas"}),e.jsx("p",{className:"text-sm text-gray-900",children:u.notes||"Sin notas"})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:()=>j(!1),className:"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cerrar"})})]})})]})},lt=He((t,r)=>({promotions:[],loading:!1,error:null,getPromotions:()=>r().promotions,getActivePromotions:()=>{const s=new Date().toISOString();return r().promotions.filter(a=>a.active&&(!a.start_date||a.start_date<=s)&&(!a.end_date||a.end_date>=s))},getPromotionById:s=>r().promotions.find(a=>a.id===s),fetchPromotions:async()=>{t({loading:!0,error:null});try{const{data:s,error:a}=await S.from("promotions").select(`
          *,
          promotion_products (
            product_id
          )
        `).order("created_at",{ascending:!1});if(a)throw a;const i=(s==null?void 0:s.map(m=>{var p;return{...m,product_ids:((p=m.promotion_products)==null?void 0:p.map(g=>g.product_id))||[]}}))||[];t({promotions:i,loading:!1})}catch(s){console.error("Error fetching promotions:",s),t({error:s.message,loading:!1})}},createPromotion:async s=>{var a;t({loading:!0,error:null});try{const{name:i,description:m,type:p,active:g,start_date:l,end_date:j,buy_quantity:u,get_quantity:E,total_price:C}=s,{data:x,error:N}=await S.from("promotions").insert([{name:i,description:m,type:p,active:g,start_date:l||null,end_date:j||null,buy_quantity:u,get_quantity:E,total_price:C,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select().single();if(N)throw N;if((a=s.product_ids)!=null&&a.length&&x){const _=s.product_ids.map(d=>({promotion_id:x.id,product_id:d})),{error:P}=await S.from("promotion_products").insert(_);if(P)throw P}return await r().fetchPromotions(),t({loading:!1}),{success:!0,data:x}}catch(i){return console.error("Error creating promotion:",i),t({error:i.message,loading:!1}),{success:!1,error:i.message}}},updatePromotion:async(s,a)=>{t({loading:!0,error:null});try{const{product_ids:i,...m}=a,{data:p,error:g}=await S.from("promotions").update({...m,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(g)throw g;if(i!==void 0){const{error:l}=await S.from("promotion_products").delete().eq("promotion_id",s);if(l)throw l;if(i.length>0){const j=i.map(E=>({promotion_id:s,product_id:E})),{error:u}=await S.from("promotion_products").insert(j);if(u)throw u}}return await r().fetchPromotions(),t({loading:!1}),{success:!0,data:p}}catch(i){return console.error("Error updating promotion:",i),t({error:i.message,loading:!1}),{success:!1,error:i.message}}},deletePromotion:async s=>{t({loading:!0,error:null});try{const{error:a}=await S.from("promotions").delete().eq("id",s);if(a)throw a;return t(i=>({promotions:i.promotions.filter(m=>m.id!==s),loading:!1})),{success:!0}}catch(a){return console.error("Error deleting promotion:",a),t({error:a.message,loading:!1}),{success:!1,error:a.message}}},togglePromotionStatus:async s=>{t({loading:!0,error:null});try{const a=r().promotions.find(p=>p.id===s);if(!a)throw new Error("Promotion not found");const{data:i,error:m}=await S.from("promotions").update({active:!a.active,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(m)throw m;return t(p=>({promotions:p.promotions.map(g=>g.id===s?i:g),loading:!1})),{success:!0}}catch(a){return console.error("Error toggling promotion status:",a),t({error:a.message,loading:!1}),{success:!1,error:a.message}}}})),ct=({onPromotionCreated:t})=>{const r=lt(),[s,a]=c.useState([]),[i,m]=c.useState(null),[p,g]=c.useState(!1),[l,j]=c.useState({name:"",description:"",type:"2x1",start_date:"",end_date:"",active:!0,product_ids:[],buy_quantity:2,get_quantity:1,total_price:0});c.useEffect(()=>{u()},[]);const u=async()=>{try{await Promise.all([r.fetchPromotions(),E()])}catch(d){console.error("Error loading data:",d),y.error("Error al cargar los datos")}},E=async()=>{try{const{data:d,error:b}=await S.from("products").select("*").order("name");if(b)throw b;a(d||[])}catch(d){console.error("Error fetching products:",d),y.error("Error al cargar los productos")}},C=d=>{m(d),j({name:d.name||"",description:d.description||"",type:d.type,start_date:d.start_date?new Date(d.start_date).toISOString().split("T")[0]:"",end_date:d.end_date?new Date(d.end_date).toISOString().split("T")[0]:"",active:d.active||!1,product_ids:d.product_ids||[],buy_quantity:d.buy_quantity||2,get_quantity:d.get_quantity||1,total_price:d.total_price||0})},x=()=>{m(null),j({name:"",description:"",type:"2x1",start_date:"",end_date:"",active:!0,product_ids:[],buy_quantity:2,get_quantity:1,total_price:0})},N=d=>{let b=2,T=1;d==="3x1"?(b=3,T=1):d==="3x2"?(b=3,T=2):d==="2x1"&&(b=2,T=1),j(O=>({...O,type:d,buy_quantity:b,get_quantity:T}))},_=async d=>{d.preventDefault();try{if(g(!0),!l.name.trim()){y.error("El nombre de la promoción es obligatorio"),g(!1);return}if(l.product_ids.length===0){y.error("Debes seleccionar al menos un producto"),g(!1);return}if(l.type==="discount"&&(!l.total_price||l.total_price<=0)){y.error("Debes ingresar un precio promocional válido mayor que cero"),g(!1);return}const b={id:i==null?void 0:i.id,name:l.name.trim(),description:l.description.trim()||void 0,type:l.type,active:l.active,start_date:l.start_date||null,end_date:l.end_date||null,product_ids:l.product_ids,buy_quantity:l.buy_quantity,get_quantity:l.get_quantity,total_price:l.type==="discount"?l.total_price:void 0,created_at:(i==null?void 0:i.created_at)||new Date().toISOString(),updated_at:new Date().toISOString()};let T;i?T=await r.updatePromotion(i.id,b):T=await r.createPromotion(b),T.success?(y.success(i?"Promoción actualizada":"Promoción creada"),x(),t&&t(),await u()):y.error(T.error||"Error al guardar la promoción")}catch(b){console.error("Error saving promotion:",b),y.error("Error al guardar la promoción: "+(b.message||"Error desconocido"))}finally{g(!1)}},P=async d=>{if(window.confirm("¿Estás seguro de eliminar esta promoción?"))try{const b=await r.deletePromotion(d);b.success?(y.success("Promoción eliminada"),await u()):y.error(b.error||"Error al eliminar la promoción")}catch(b){console.error("Error deleting promotion:",b),y.error("Error al eliminar la promoción")}};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Gestión de Promociones"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:i?"Editar Promoción":"Nueva Promoción"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nombre"}),e.jsx("input",{type:"text",value:l.name,onChange:d=>j(b=>({...b,name:d.target.value})),className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Descripción"}),e.jsx("textarea",{value:l.description,onChange:d=>j(b=>({...b,description:d.target.value})),className:"w-full p-2 border rounded",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo de Promoción"}),e.jsxs("select",{value:l.type,onChange:d=>N(d.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"2x1",children:"2x1 (Lleva 2, paga 1)"}),e.jsx("option",{value:"3x2",children:"3x2 (Lleva 3, paga 2)"}),e.jsx("option",{value:"3x1",children:"3x1 (Lleva 3, paga 1)"}),e.jsx("option",{value:"discount",children:"Descuento (Precio fijo promocional)"})]})]}),l.type!=="discount"?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Comprar (cantidad)"}),e.jsx("input",{type:"number",value:l.buy_quantity,readOnly:!0,className:"w-full p-2 border rounded bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se establece automáticamente según el tipo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Llevar (cantidad)"}),e.jsx("input",{type:"number",value:l.get_quantity,readOnly:!0,className:"w-full p-2 border rounded bg-gray-100"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se establece automáticamente según el tipo"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Precio Promocional"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-500 mr-2",children:"$"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:l.total_price,onChange:d=>j(b=>({...b,total_price:parseFloat(d.target.value)||0})),className:"w-full p-2 border rounded",required:l.type==="discount"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ingresa el precio final con descuento (no el porcentaje)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fecha de inicio"}),e.jsx("input",{type:"date",value:l.start_date,onChange:d=>j(b=>({...b,start_date:d.target.value})),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fecha de fin"}),e.jsx("input",{type:"date",value:l.end_date,onChange:d=>j(b=>({...b,end_date:d.target.value})),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Productos"}),e.jsx("select",{multiple:!0,value:l.product_ids,onChange:d=>{const b=Array.from(d.target.selectedOptions,T=>T.value);j(T=>({...T,product_ids:b}))},className:"w-full p-2 border rounded",size:5,children:s.map(d=>e.jsxs("option",{value:d.id,children:[d.name," - $",d.price]},d.id))}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Mantén presionada la tecla Ctrl para seleccionar múltiples productos"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.active,onChange:d=>j(b=>({...b,active:d.target.checked})),className:"mr-2"}),e.jsx("label",{className:"text-sm font-medium",children:"Promoción activa"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"submit",disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Procesando...":(i?"Actualizar":"Crear")+" Promoción"}),i&&e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancelar"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Promociones Existentes"}),e.jsxs("div",{className:"space-y-4",children:[r.promotions.map(d=>{var b;return e.jsxs("div",{className:"border rounded p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:d.name}),d.description&&e.jsx("p",{className:"text-sm text-gray-600",children:d.description})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>C(d),className:"text-blue-600 hover:text-blue-800",children:"Editar"}),e.jsx("button",{onClick:()=>P(d.id),className:"text-red-600 hover:text-red-800",children:"Eliminar"})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:["Tipo: ",d.type==="2x1"?"Lleva 2, paga 1":d.type==="3x2"?"Lleva 3, paga 2":d.type==="3x1"?"Lleva 3, paga 1":d.type==="discount"?"Descuento (Precio fijo: $"+d.total_price+")":d.type]}),e.jsxs("p",{children:["Estado: ",e.jsx("span",{className:d.active?"text-green-600":"text-red-600",children:d.active?"Activa":"Inactiva"})]}),d.start_date&&e.jsxs("p",{children:["Inicio: ",new Date(d.start_date).toLocaleDateString()]}),d.end_date&&e.jsxs("p",{children:["Fin: ",new Date(d.end_date).toLocaleDateString()]}),e.jsxs("p",{children:["Productos: ",((b=d.product_ids)==null?void 0:b.length)||0," seleccionados"]})]})]},d.id)}),r.promotions.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No hay promociones creadas"})]})]})]})]})};function dt(){const[t,r]=c.useState([]),[s,a]=c.useState(!0),[i,m]=c.useState(!1),[p,g]=c.useState("add"),[l,j]=c.useState({}),[u,E]=c.useState([]),[C,x]=c.useState(!1),[N,_]=c.useState(null),[P,d]=c.useState(!1),b=c.useRef(null),T=c.useRef(null);c.useEffect(()=>{O()},[]);const O=async()=>{try{a(!0);const{data:n,error:h}=await S.from("products").select("*").order("created_at",{ascending:!1});if(h)throw h;r(n||[])}catch(n){console.error("Error loading products:",n),y.error("Error al cargar los productos")}finally{a(!1)}},$=n=>{const{name:h,value:o}=n.target;j({...l,[h]:o})},f=n=>{const h=n.target.files;if(!h)return;if(u.length+h.length>10){y.error("Máximo 10 imágenes permitidas");return}x(!0);const o=[];Array.from(h).forEach(v=>{if(v.size>5*1024*1024){y.error(`${v.name} es muy grande. Máximo 5MB`);return}if(!v.type.startsWith("image/")){y.error(`${v.name} no es una imagen válida`);return}const D=new FileReader;D.onload=M=>{var A;(A=M.target)!=null&&A.result&&(o.push(M.target.result),o.length===h.length&&(E([...u,...o]),x(!1),y.success(`${o.length} imagen(es) agregada(s)`)))},D.readAsDataURL(v)}),b.current&&(b.current.value="")},w=n=>{const h=u.filter((o,v)=>v!==n);E(h),y.success("Imagen eliminada")},L=(n,h)=>{const o=[...u],[v]=o.splice(n,1);o.splice(h,0,v),E(o)},k=n=>{var D;const h=(D=n.target.files)==null?void 0:D[0];if(!h)return;if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(h.type)){y.error("Tipo de archivo no permitido. Use PDF, DOC, DOCX o TXT");return}if(h.size>10*1024*1024){y.error("El archivo es muy grande. Máximo 10MB");return}d(!0);const v=new FileReader;v.onload=M=>{var A;(A=M.target)!=null&&A.result&&(_(M.target.result),d(!1),y.success("Manual subido correctamente"))},v.onerror=()=>{d(!1),y.error("Error al leer el archivo")},v.readAsDataURL(h),T.current&&(T.current.value="")},q=()=>{_(null),y.success("Manual eliminado")},G=()=>{if(N)try{const n=document.createElement("a");n.href=N,n.download=`manual-${l.name||"producto"}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch{y.error("Error al descargar el manual")}},V=n=>{try{const h=n.substring(n.indexOf(":")+1,n.indexOf(";")),o=h.includes("pdf")?"PDF":h.includes("word")?"DOC":h.includes("document")?"DOCX":"DOC",v=Math.round(n.length*.75/1024);return{extension:o,sizeInKB:v}}catch{return{extension:"DOC",sizeInKB:0}}},X=()=>{g("add"),j({}),E([]),_(null),m(!0)},W=n=>{g("edit"),j(n),E(n.images||[]),_(n.instructions_file||null),m(!0)},J=async n=>{if(window.confirm("¿Estás seguro de que quieres eliminar este producto?"))try{const{error:h}=await S.from("products").delete().eq("id",n);if(h)throw h;y.success("Producto eliminado correctamente"),O()}catch(h){console.error("Error deleting product:",h),y.error("Error al eliminar el producto")}},Y=async n=>{if(n.preventDefault(),!l.name||!l.price){y.error("Por favor completa todos los campos obligatorios");return}try{const h={...l,images:u.length>0?u:null,instructions_file:N,updated_at:new Date().toISOString()};if(p==="add"){const{error:o}=await S.from("products").insert([h]);if(o)throw o;y.success("Producto añadido correctamente")}else{const{error:o}=await S.from("products").update(h).eq("id",l.id);if(o)throw o;y.success("Producto actualizado correctamente")}m(!1),E([]),_(null),O()}catch(h){console.error("Error saving product:",h),y.error("Error al guardar el producto")}};return s?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Productos"}),e.jsxs("button",{onClick:X,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 flex items-center",children:[e.jsx(Ce,{className:"h-5 w-5 mr-2"}),"Añadir Producto"]})]}),i?e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:p==="add"?"Añadir Producto":"Editar Producto"}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(ne,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx("input",{type:"text",id:"name",name:"name",value:l.name||"",onChange:$,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio"}),e.jsx("input",{type:"number",id:"price",name:"price",value:l.price||"",onChange:$,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stock",className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock"}),e.jsx("input",{type:"number",id:"stock",name:"stock",value:l.stock||"",onChange:$,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoría"}),e.jsx("input",{type:"text",id:"category",name:"category",value:l.category||"",onChange:$,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shipping_days",className:"block text-sm font-medium text-gray-700 mb-1",children:"Días Hábiles de Envío"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"text",id:"shipping_days",name:"shipping_days",value:l.shipping_days||"",onChange:$,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Ej: 10, 10-15, 5-7"}),e.jsx(ee,{className:"h-5 w-5 ml-2 text-indigo-600"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:'Tiempo estimado de entrega en días hábiles (puedes usar rangos como "10-15")'})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:l.description||"",onChange:$,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Imágenes del producto"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{ref:b,type:"file",multiple:!0,accept:"image/*",onChange:f,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(Le,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:()=>{var n;return(n=b.current)==null?void 0:n.click()},disabled:C||u.length>=10,className:"text-indigo-600 hover:text-indigo-500 font-medium disabled:opacity-50",children:C?"Subiendo...":"Haz clic para subir imágenes"}),e.jsx("span",{className:"text-gray-500",children:" o arrastra aquí"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, JPEG hasta 5MB cada una"}),e.jsxs("p",{className:"text-xs text-gray-400",children:[u.length,"/10 imágenes"]})]})]}),u.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:u.map((n,h)=>e.jsxs("div",{className:"relative group aspect-square bg-gray-100 rounded-lg overflow-hidden",children:[e.jsx("img",{src:n,alt:`Producto ${h+1}`,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>w(h),className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex justify-between opacity-0 group-hover:opacity-100 transition-opacity",children:[h>0&&e.jsx("button",{type:"button",onClick:()=>L(h,h-1),className:"px-2 py-1 bg-black bg-opacity-70 text-white text-xs rounded hover:bg-opacity-80",children:"←"}),e.jsx("span",{className:"px-2 py-1 bg-black bg-opacity-70 text-white text-xs rounded",children:h+1}),h<u.length-1&&e.jsx("button",{type:"button",onClick:()=>L(h,h+1),className:"px-2 py-1 bg-black bg-opacity-70 text-white text-xs rounded hover:bg-opacity-80",children:"→"})]}),h===0&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-green-600 text-white text-xs rounded",children:"Principal"})]},h))}),u.length===0&&e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[e.jsx("p",{children:"• La primera imagen será la imagen principal del producto"}),e.jsx("p",{children:"• Puedes reordenar las imágenes arrastrando"}),e.jsx("p",{children:"• Máximo 10 imágenes por producto"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manual del producto (opcional)"}),N?e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ve,{className:"h-8 w-8 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Manual del producto"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[V(N).extension," • ~",V(N).sizeInKB,"KB"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:G,className:"p-2 text-gray-400 hover:text-indigo-600 transition-colors",title:"Descargar manual",children:e.jsx(Ze,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:q,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Eliminar manual",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{ref:T,type:"file",accept:".pdf,.doc,.docx,.txt",onChange:k,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(ve,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:()=>{var n;return(n=T.current)==null?void 0:n.click()},disabled:P,className:"text-indigo-600 hover:text-indigo-500 font-medium disabled:opacity-50",children:P?"Subiendo...":"Haz clic para subir manual"}),e.jsx("span",{className:"text-gray-500",children:" o arrastra aquí"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"PDF, DOC, DOCX, TXT hasta 10MB"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Manual de usuario, instrucciones o documentación del producto"})]})]}),N&&e.jsxs("div",{className:"mt-2",children:[e.jsx("button",{type:"button",onClick:()=>{var n;return(n=T.current)==null?void 0:n.click()},disabled:P,className:"text-sm text-indigo-600 hover:text-indigo-500 disabled:opacity-50",children:P?"Subiendo...":"Reemplazar manual"}),e.jsx("input",{ref:T,type:"file",accept:".pdf,.doc,.docx,.txt",onChange:k,className:"hidden"})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[e.jsx("p",{children:"• Los clientes podrán descargar este manual desde la página del producto"}),e.jsx("p",{children:"• Formatos soportados: PDF, DOC, DOCX, TXT"}),e.jsx("p",{children:"• Tamaño máximo: 10MB"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:p==="add"?"Añadir":"Guardar"})]})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoría"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Días de Envío"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[n.images&&n.images.length>0&&e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("img",{className:"h-10 w-10 rounded-full object-cover\\",src:n.images[0],alt:""})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:["$",n.price]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:n.stock})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:n.category})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:n.shipping_days?`${n.shipping_days} días hábiles`:"No especificado"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>W(n),className:"text-indigo-600 hover:text-indigo-900 mr-4",children:e.jsx(ot,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>J(n.id),className:"text-red-600 hover:text-red-900",children:e.jsx(oe,{className:"h-5 w-5"})})]})]},n.id))})]})})]})}const U={name:"Calidad Premium",logo_url:null,hero_title:"Productos de Calidad Premium",hero_subtitle:"Descubre nuestra selección de productos exclusivos con la mejor calidad garantizada",logo_width:200,logo_height:60,maintain_ratio:!0,dropshipping_shipping_cost:0};function mt(){const[t,r]=c.useState(null),[s,a]=c.useState(!0),[i,m]=c.useState(!1),[p,g]=c.useState(""),[l,j]=c.useState(""),[u,E]=c.useState(""),[C,x]=c.useState(null),[N,_]=c.useState(200),[P,d]=c.useState(60),[b,T]=c.useState(!0),[O,$]=c.useState(200/60),[f,w]=c.useState(0),L=c.useRef(null),k=c.useRef(null);c.useEffect(()=>{G()},[]);const q=async()=>{try{const{data:n,error:h}=await S.from("company_settings").insert({...U,updated_at:new Date().toISOString()}).select().single();if(h)throw h;return n}catch(n){throw console.error("Error creating default settings:",n),n}},G=async()=>{try{a(!0);let{data:n,error:h}=await S.from("company_settings").select("*").limit(1);if((!n||n.length===0)&&!h)try{n=[await q()]}catch(v){console.error("Error creating default settings:",v),n=[{id:"temp-id",...U,updated_at:new Date().toISOString()}]}else h&&(console.error("Error loading settings:",h),n=[{id:"temp-id",...U,updated_at:new Date().toISOString()}]);const o=n[0];if(r(o),g(o.name||U.name),j(o.hero_title||U.hero_title),E(o.hero_subtitle||U.hero_subtitle),x(o.logo_url),_(o.logo_width||U.logo_width),d(o.logo_height||U.logo_height),T(o.maintain_ratio!==void 0?o.maintain_ratio:U.maintain_ratio),w(o.dropshipping_shipping_cost||U.dropshipping_shipping_cost),o.logo_url&&o.maintain_ratio){const v=new Image;v.onload=()=>{$(v.naturalWidth/v.naturalHeight)},v.src=o.logo_url}}catch(n){console.error("Error loading settings:",n),y.error("Error al cargar la configuración");const h={id:"temp-id",...U,updated_at:new Date().toISOString()};r(h),g(h.name),j(h.hero_title),E(h.hero_subtitle),x(h.logo_url),_(h.logo_width),d(h.logo_height),T(h.maintain_ratio),w(h.dropshipping_shipping_cost)}finally{a(!1)}},V=async n=>{if(!["image/png","image/jpeg","image/svg+xml"].includes(n.type))return y.error("Formato no permitido. Use PNG, JPG o SVG"),null;if(n.size>2*1024*1024)return y.error("El archivo es demasiado grande. Máximo 2MB"),null;try{const o=n.name.split(".").pop(),D=`${`${Math.random()}.${o}`}`,{error:M,data:A}=await S.storage.from("logos").upload(D,n,{cacheControl:"3600",upsert:!1});if(M)throw M;const{data:{publicUrl:R}}=S.storage.from("logos").getPublicUrl(D),z=new Image;return z.onload=()=>{const H=z.naturalWidth/z.naturalHeight;if($(H),b){const K=Math.min(200,z.naturalWidth);_(K),d(Math.round(K/H))}},z.src=R,R}catch(o){return console.error("Error uploading logo:",o),y.error("Error al subir el logo"),null}},X=n=>{n=Math.min(500,Math.max(50,n)),_(n),b&&d(Math.round(n/O))},W=n=>{n=Math.min(500,Math.max(50,n)),d(n),b&&_(Math.round(n*O))},J=async()=>{var n,h;if(t)try{if(m(!0),!p.trim()){y.error("El nombre de la empresa es requerido");return}if(p.length>50){y.error("El nombre es demasiado largo (máximo 50 caracteres)");return}if(!l.trim()||!u.trim()){y.error("El título y subtítulo del hero son requeridos");return}if(f<0){y.error("El costo de envío para dropshipping no puede ser negativo");return}let o=t.logo_url;if((h=(n=L.current)==null?void 0:n.files)!=null&&h.length){const M=L.current.files[0],A=await V(M);if(A){if(t.logo_url){const R=t.logo_url.split("/").pop();R&&await S.storage.from("logos").remove([R])}o=A}}const v={name:p,logo_url:o,hero_title:l,hero_subtitle:u,logo_width:N,logo_height:P,maintain_ratio:b,dropshipping_shipping_cost:f,updated_at:new Date().toISOString()};let D;if(t.id==="temp-id"){const{data:M,error:A}=await S.from("company_settings").insert(v).select().single();if(A)throw A;D=M}else{const{data:M,error:A}=await S.from("company_settings").update(v).eq("id",t.id).select().single();if(A)throw A;D=M}y.success("Configuración guardada exitosamente"),r(D)}catch(o){console.error("Error saving settings:",o),y.error("Error al guardar la configuración")}finally{m(!1)}},Y=async()=>{if(t!=null&&t.logo_url)try{m(!0);const n=t.logo_url.split("/").pop();n&&await S.storage.from("logos").remove([n]);const{error:h}=await S.from("company_settings").update({logo_url:null,updated_at:new Date().toISOString()}).eq("id",t.id);if(h)throw h;y.success("Logo eliminado exitosamente"),x(null),L.current&&(L.current.value=""),G()}catch(n){console.error("Error removing logo:",n),y.error("Error al eliminar el logo")}finally{m(!1)}};return s?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Configuración de la Empresa"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Empresa"}),e.jsx("input",{type:"text",value:p,onChange:n=>g(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Nombre de la empresa",maxLength:50}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[p.length,"/50 caracteres"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Texto Principal (Hero)"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Título Principal"}),e.jsx("input",{type:"text",value:l,onChange:n=>j(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Título principal del hero"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subtítulo"}),e.jsx("textarea",{value:u,onChange:n=>E(n.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Subtítulo del hero"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 mr-2"}),"Configuración de Dropshipping"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Costo de Envío para Usuarios Dropshipping"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-500 mr-2",children:"$"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:f,onChange:n=>w(parseFloat(n.target.value)||0),className:"w-32 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"0.00"})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Este costo se aplicará a los pedidos realizados por usuarios con rol de dropshipping. Si se establece en 0, el envío será gratuito para estos usuarios."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo de la Empresa"}),e.jsx("div",{className:"mb-4",children:C?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{ref:k,src:C,alt:"Logo de la empresa",style:{width:`${N}px`,height:`${P}px`},className:"object-contain border rounded-md"}),e.jsx("button",{onClick:Y,className:"absolute -top-2 -right-2 bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200",title:"Eliminar logo",children:e.jsx(ne,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"flex items-center justify-center w-[200px] h-[60px] bg-gray-100 border-2 border-dashed border-gray-300 rounded-md",children:e.jsx(st,{className:"h-8 w-8 text-gray-400"})})}),C&&e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ancho (px)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:"50",max:"500",value:N,onChange:n=>X(parseInt(n.target.value)),className:"w-32"}),e.jsx("input",{type:"number",min:"50",max:"500",value:N,onChange:n=>X(parseInt(n.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alto (px)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:"50",max:"500",value:P,onChange:n=>W(parseInt(n.target.value)),className:"w-32"}),e.jsx("input",{type:"number",min:"50",max:"500",value:P,onChange:n=>W(parseInt(n.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded-md"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>T(!b),className:`flex items-center px-3 py-1 rounded-md text-sm ${b?"bg-indigo-100 text-indigo-700":"bg-gray-100 text-gray-700"}`,children:[b?e.jsx(Pe,{className:"h-4 w-4 mr-1"}):e.jsx(nt,{className:"h-4 w-4 mr-1"}),"Mantener proporción"]}),e.jsx("button",{onClick:()=>{_(200),d(60)},className:"text-sm text-indigo-600 hover:text-indigo-500",children:"Restablecer tamaño"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"file",ref:L,accept:".png,.jpg,.jpeg,.svg",className:"hidden",onChange:n=>{var o;const h=(o=n.target.files)==null?void 0:o[0];if(h){const v=new FileReader;v.onload=D=>{var M;x((M=D.target)==null?void 0:M.result)},v.readAsDataURL(h)}}}),e.jsxs("button",{onClick:()=>{var n;return(n=L.current)==null?void 0:n.click()},className:"flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Subir Logo"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"PNG, JPG o SVG. Máximo 2MB."})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:J,disabled:i,className:"flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Guardar Cambios"]})})})]})]})}var ut=Object.defineProperty,pt=(t,r,s)=>r in t?ut(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,ce=(t,r,s)=>(pt(t,typeof r!="symbol"?r+"":r,s),s);let xt=class{constructor(){ce(this,"current",this.detect()),ce(this,"handoffState","pending"),ce(this,"currentId",0)}set(r){this.current!==r&&(this.handoffState="pending",this.currentId=0,this.current=r)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},Z=new xt,Q=(t,r)=>{Z.isServer?c.useEffect(t,r):c.useLayoutEffect(t,r)};function ht(t){let r=c.useRef(t);return Q(()=>{r.current=t},[t]),r}let B=function(t){let r=ht(t);return F.useCallback((...s)=>r.current(...s),[r])};function gt(t,r,s){let[a,i]=c.useState(s),m=t!==void 0,p=c.useRef(m),g=c.useRef(!1),l=c.useRef(!1);return m&&!p.current&&!g.current?(g.current=!0,p.current=m,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!m&&p.current&&!l.current&&(l.current=!0,p.current=m,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[m?t:a,B(j=>(m||i(j),r==null?void 0:r(j)))]}function ft(t){typeof queueMicrotask=="function"?queueMicrotask(t):Promise.resolve().then(t).catch(r=>setTimeout(()=>{throw r}))}function Ae(){let t=[],r={addEventListener(s,a,i,m){return s.addEventListener(a,i,m),r.add(()=>s.removeEventListener(a,i,m))},requestAnimationFrame(...s){let a=requestAnimationFrame(...s);return r.add(()=>cancelAnimationFrame(a))},nextFrame(...s){return r.requestAnimationFrame(()=>r.requestAnimationFrame(...s))},setTimeout(...s){let a=setTimeout(...s);return r.add(()=>clearTimeout(a))},microTask(...s){let a={current:!0};return ft(()=>{a.current&&s[0]()}),r.add(()=>{a.current=!1})},style(s,a,i){let m=s.style.getPropertyValue(a);return Object.assign(s.style,{[a]:i}),this.add(()=>{Object.assign(s.style,{[a]:m})})},group(s){let a=Ae();return s(a),this.add(()=>a.dispose())},add(s){return t.push(s),()=>{let a=t.indexOf(s);if(a>=0)for(let i of t.splice(a,1))i()}},dispose(){for(let s of t.splice(0))s()}};return r}function yt(){let[t]=c.useState(Ae);return c.useEffect(()=>()=>t.dispose(),[t]),t}function bt(){let t=typeof document>"u";return"useSyncExternalStore"in Ne?(r=>r.useSyncExternalStore)(Ne)(()=>()=>{},()=>!1,()=>!t):!1}function jt(){let t=bt(),[r,s]=c.useState(Z.isHandoffComplete);return r&&Z.isHandoffComplete===!1&&s(!1),c.useEffect(()=>{r!==!0&&s(!0)},[r]),c.useEffect(()=>Z.handoff(),[]),t?!1:r}var ke;let he=(ke=F.useId)!=null?ke:function(){let t=jt(),[r,s]=F.useState(t?()=>Z.nextId():null);return Q(()=>{r===null&&s(Z.nextId())},[r]),r!=null?""+r:void 0};function $e(t,r,...s){if(t in r){let i=r[t];return typeof i=="function"?i(...s):i}let a=new Error(`Tried to handle "${t}" but there is no handler defined. Only defined handlers are: ${Object.keys(r).map(i=>`"${i}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,$e),a}function Ee(t){var r;if(t.type)return t.type;let s=(r=t.as)!=null?r:"button";if(typeof s=="string"&&s.toLowerCase()==="button")return"button"}function vt(t,r){let[s,a]=c.useState(()=>Ee(t));return Q(()=>{a(Ee(t))},[t.type,t.as]),Q(()=>{s||r.current&&r.current instanceof HTMLButtonElement&&!r.current.hasAttribute("type")&&a("button")},[s,r]),s}let Nt=Symbol();function ge(...t){let r=c.useRef(t);c.useEffect(()=>{r.current=t},[t]);let s=B(a=>{for(let i of r.current)i!=null&&(typeof i=="function"?i(a):i.current=a)});return t.every(a=>a==null||(a==null?void 0:a[Nt]))?void 0:s}function Se(...t){return Array.from(new Set(t.flatMap(r=>typeof r=="string"?r.split(" "):[]))).filter(Boolean).join(" ")}var wt=(t=>(t[t.None=0]="None",t[t.RenderStrategy=1]="RenderStrategy",t[t.Static=2]="Static",t))(wt||{}),_t=(t=>(t[t.Unmount=0]="Unmount",t[t.Hidden=1]="Hidden",t))(_t||{});function te({ourProps:t,theirProps:r,slot:s,defaultTag:a,features:i,visible:m=!0,name:p,mergeRefs:g}){g=g??kt;let l=qe(r,t);if(m)return ae(l,s,a,p,g);let j=i??0;if(j&2){let{static:u=!1,...E}=l;if(u)return ae(E,s,a,p,g)}if(j&1){let{unmount:u=!0,...E}=l;return $e(u?0:1,{0(){return null},1(){return ae({...E,hidden:!0,style:{display:"none"}},s,a,p,g)}})}return ae(l,s,a,p,g)}function ae(t,r={},s,a,i){let{as:m=s,children:p,refName:g="ref",...l}=de(t,["unmount","static"]),j=t.ref!==void 0?{[g]:t.ref}:{},u=typeof p=="function"?p(r):p;"className"in l&&l.className&&typeof l.className=="function"&&(l.className=l.className(r));let E={};if(r){let C=!1,x=[];for(let[N,_]of Object.entries(r))typeof _=="boolean"&&(C=!0),_===!0&&x.push(N);C&&(E["data-headlessui-state"]=x.join(" "))}if(m===c.Fragment&&Object.keys(ue(l)).length>0){if(!c.isValidElement(u)||Array.isArray(u)&&u.length>1)throw new Error(['Passing props on "Fragment"!',"",`The current component <${a} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(l).map(_=>`  - ${_}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(_=>`  - ${_}`).join(`
`)].join(`
`));let C=u.props,x=typeof(C==null?void 0:C.className)=="function"?(..._)=>Se(C==null?void 0:C.className(..._),l.className):Se(C==null?void 0:C.className,l.className),N=x?{className:x}:{};return c.cloneElement(u,Object.assign({},qe(u.props,ue(de(l,["ref"]))),E,j,{ref:i(u.ref,j.ref)},N))}return c.createElement(m,Object.assign({},de(l,["ref"]),m!==c.Fragment&&j,m!==c.Fragment&&E),u)}function kt(...t){return t.every(r=>r==null)?void 0:r=>{for(let s of t)s!=null&&(typeof s=="function"?s(r):s.current=r)}}function qe(...t){if(t.length===0)return{};if(t.length===1)return t[0];let r={},s={};for(let a of t)for(let i in a)i.startsWith("on")&&typeof a[i]=="function"?(s[i]!=null||(s[i]=[]),s[i].push(a[i])):r[i]=a[i];if(r.disabled||r["aria-disabled"])return Object.assign(r,Object.fromEntries(Object.keys(s).map(a=>[a,void 0])));for(let a in s)Object.assign(r,{[a](i,...m){let p=s[a];for(let g of p){if((i instanceof Event||(i==null?void 0:i.nativeEvent)instanceof Event)&&i.defaultPrevented)return;g(i,...m)}}});return r}function ie(t){var r;return Object.assign(c.forwardRef(t),{displayName:(r=t.displayName)!=null?r:t.name})}function ue(t){let r=Object.assign({},t);for(let s in r)r[s]===void 0&&delete r[s];return r}function de(t,r=[]){let s=Object.assign({},t);for(let a of r)a in s&&delete s[a];return s}let Et="div";var Oe=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(Oe||{});function St(t,r){var s;let{features:a=1,...i}=t,m={ref:r,"aria-hidden":(a&2)===2?!0:(s=i["aria-hidden"])!=null?s:void 0,hidden:(a&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(a&4)===4&&(a&2)!==2&&{display:"none"}}};return te({ourProps:m,theirProps:i,slot:{},defaultTag:Et,name:"Hidden"})}let Ct=ie(St);function Pt(t){let r=t.parentElement,s=null;for(;r&&!(r instanceof HTMLFieldSetElement);)r instanceof HTMLLegendElement&&(s=r),r=r.parentElement;let a=(r==null?void 0:r.getAttribute("disabled"))==="";return a&&Dt(s)?!1:a}function Dt(t){if(!t)return!1;let r=t.previousElementSibling;for(;r!==null;){if(r instanceof HTMLLegendElement)return!1;r=r.previousElementSibling}return!0}function Mt(t){var r,s;let a=(r=t==null?void 0:t.form)!=null?r:t.closest("form");if(a){for(let i of a.elements)if(i!==t&&(i.tagName==="INPUT"&&i.type==="submit"||i.tagName==="BUTTON"&&i.type==="submit"||i.nodeName==="INPUT"&&i.type==="image")){i.click();return}(s=a.requestSubmit)==null||s.call(a)}}var pe=(t=>(t.Space=" ",t.Enter="Enter",t.Escape="Escape",t.Backspace="Backspace",t.Delete="Delete",t.ArrowLeft="ArrowLeft",t.ArrowUp="ArrowUp",t.ArrowRight="ArrowRight",t.ArrowDown="ArrowDown",t.Home="Home",t.End="End",t.PageUp="PageUp",t.PageDown="PageDown",t.Tab="Tab",t))(pe||{});let Re=c.createContext(null);function Fe(){let t=c.useContext(Re);if(t===null){let r=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(r,Fe),r}return t}function Tt(){let[t,r]=c.useState([]);return[t.length>0?t.join(" "):void 0,c.useMemo(()=>function(s){let a=B(m=>(r(p=>[...p,m]),()=>r(p=>{let g=p.slice(),l=g.indexOf(m);return l!==-1&&g.splice(l,1),g}))),i=c.useMemo(()=>({register:a,slot:s.slot,name:s.name,props:s.props}),[a,s.slot,s.name,s.props]);return F.createElement(Re.Provider,{value:i},s.children)},[r])]}let Lt="p";function At(t,r){let s=he(),{id:a=`headlessui-description-${s}`,...i}=t,m=Fe(),p=ge(r);Q(()=>m.register(a),[a,m.register]);let g={ref:p,...m.props,id:a};return te({ourProps:g,theirProps:i,slot:m.slot||{},defaultTag:Lt,name:m.name||"Description"})}let $t=ie(At),qt=Object.assign($t,{}),Ie=c.createContext(null);function Ue(){let t=c.useContext(Ie);if(t===null){let r=new Error("You used a <Label /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(r,Ue),r}return t}function Ot(){let[t,r]=c.useState([]);return[t.length>0?t.join(" "):void 0,c.useMemo(()=>function(s){let a=B(m=>(r(p=>[...p,m]),()=>r(p=>{let g=p.slice(),l=g.indexOf(m);return l!==-1&&g.splice(l,1),g}))),i=c.useMemo(()=>({register:a,slot:s.slot,name:s.name,props:s.props}),[a,s.slot,s.name,s.props]);return F.createElement(Ie.Provider,{value:i},s.children)},[r])]}let Rt="label";function Ft(t,r){let s=he(),{id:a=`headlessui-label-${s}`,passive:i=!1,...m}=t,p=Ue(),g=ge(r);Q(()=>p.register(a),[a,p.register]);let l={ref:g,...p.props,id:a};return i&&("onClick"in l&&(delete l.htmlFor,delete l.onClick),"onClick"in m&&delete m.onClick),te({ourProps:l,theirProps:m,slot:p.slot||{},defaultTag:Rt,name:p.name||"Label"})}let It=ie(Ft),Ut=Object.assign(It,{}),fe=c.createContext(null);fe.displayName="GroupContext";let zt=c.Fragment;function Ht(t){var r;let[s,a]=c.useState(null),[i,m]=Ot(),[p,g]=Tt(),l=c.useMemo(()=>({switch:s,setSwitch:a,labelledby:i,describedby:p}),[s,a,i,p]),j={},u=t;return F.createElement(g,{name:"Switch.Description"},F.createElement(m,{name:"Switch.Label",props:{htmlFor:(r=l.switch)==null?void 0:r.id,onClick(E){s&&(E.currentTarget.tagName==="LABEL"&&E.preventDefault(),s.click(),s.focus({preventScroll:!0}))}}},F.createElement(fe.Provider,{value:l},te({ourProps:j,theirProps:u,defaultTag:zt,name:"Switch.Group"}))))}let Bt="button";function Gt(t,r){var s;let a=he(),{id:i=`headlessui-switch-${a}`,checked:m,defaultChecked:p=!1,onChange:g,disabled:l=!1,name:j,value:u,form:E,...C}=t,x=c.useContext(fe),N=c.useRef(null),_=ge(N,r,x===null?null:x.setSwitch),[P,d]=gt(m,g,p),b=B(()=>d==null?void 0:d(!P)),T=B(k=>{if(Pt(k.currentTarget))return k.preventDefault();k.preventDefault(),b()}),O=B(k=>{k.key===pe.Space?(k.preventDefault(),b()):k.key===pe.Enter&&Mt(k.currentTarget)}),$=B(k=>k.preventDefault()),f=c.useMemo(()=>({checked:P}),[P]),w={id:i,ref:_,role:"switch",type:vt(t,N),tabIndex:t.tabIndex===-1?0:(s=t.tabIndex)!=null?s:0,"aria-checked":P,"aria-labelledby":x==null?void 0:x.labelledby,"aria-describedby":x==null?void 0:x.describedby,disabled:l,onClick:T,onKeyUp:O,onKeyPress:$},L=yt();return c.useEffect(()=>{var k;let q=(k=N.current)==null?void 0:k.closest("form");q&&p!==void 0&&L.addEventListener(q,"reset",()=>{d(p)})},[N,d]),F.createElement(F.Fragment,null,j!=null&&P&&F.createElement(Ct,{features:Oe.Hidden,...ue({as:"input",type:"checkbox",hidden:!0,readOnly:!0,disabled:l,form:E,checked:P,name:j,value:u})}),te({ourProps:w,theirProps:C,slot:f,defaultTag:Bt,name:"Switch"}))}let Vt=ie(Gt),Xt=Ht,Wt=Object.assign(Vt,{Group:Xt,Label:Ut,Description:qt});function Kt(){const{settings:t,loading:r,updateSettings:s}=Ye(),[a,i]=c.useState(!1),[m,p]=c.useState((t==null?void 0:t.free_shipping_threshold)||1e5),[g,l]=c.useState((t==null?void 0:t.free_shipping_enabled)||!0);c.useEffect(()=>{t&&(p(t.free_shipping_threshold),l(t.free_shipping_enabled))},[t]);const j=async()=>{if(t)try{if(i(!0),m<0){y.error("El monto mínimo no puede ser negativo");return}const u=await s({free_shipping_threshold:m,free_shipping_enabled:g});if(u.success)y.success("Configuración de envío actualizada");else throw new Error(u.error||"Error al actualizar la configuración")}catch(u){console.error("Error saving shipping settings:",u),y.error(u.message||"Error al guardar la configuración")}finally{i(!1)}};return r?e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})]})]})}):e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[e.jsx(ee,{className:"h-6 w-6 mr-2"}),"Configuración de Envío"]}),e.jsx("button",{onClick:j,disabled:a,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Guardar Cambios"]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Activar envío gratis"}),e.jsx(Wt,{checked:g,onChange:l,className:`${g?"bg-indigo-600":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2`,children:e.jsx("span",{className:`${g?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Habilita o deshabilita la opción de envío gratis para pedidos que superen el monto mínimo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Monto mínimo para envío gratis"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx("input",{type:"number",value:m,onChange:u=>p(parseFloat(u.target.value)||0),disabled:!g,className:"focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:!g&&e.jsx(Pe,{className:"h-4 w-4 text-gray-400"})})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Los pedidos que superen este monto tendrán envío gratis"})]}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"Los cambios en la configuración de envío se aplicarán a todos los pedidos nuevos. Los pedidos existentes no se verán afectados."})})]})})]})]})}function Jt(){const[t,r]=c.useState([]),[s,a]=c.useState(!0),[i,m]=c.useState(null),[p,g]=c.useState(""),[l,j]=c.useState(new Set),u=async()=>{try{a(!0),m(null);const{data:x,error:N}=await S.functions.invoke("list-users",{body:{}});if(N)throw N;if(!(x!=null&&x.users))throw new Error("No users data received");r(x.users)}catch(x){console.error("Error loading users:",x),m(x.message||"Error al cargar los usuarios"),y.error("Error al cargar los usuarios")}finally{a(!1)}};c.useEffect(()=>{u()},[]);const E=async(x,N)=>{j(_=>new Set([..._,x]));try{console.log("Updating role for user:",x,"to:",N);const{data:_,error:P}=await S.functions.invoke("list-users",{method:"PUT",body:{userId:x,newRole:N}});if(P)throw console.error("Supabase function error:",P),new Error(P.message||"Error al actualizar el rol");if(_!=null&&_.error)throw console.error("Function returned error:",_.error),new Error(_.error);console.log("Role update successful:",_),y.success("✅ Rol actualizado exitosamente"),r(d=>d.map(b=>b.id===x?{...b,role:N}:b))}catch(_){console.error("Error updating user role:",_),y.error(_.message||"Error al actualizar el rol"),u()}finally{j(_=>{const P=new Set(_);return P.delete(x),P})}},C=t.filter(x=>{var N;return x.email.toLowerCase().includes(p.toLowerCase())||((N=x.full_name)==null?void 0:N.toLowerCase().includes(p.toLowerCase()))});return s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):i?e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:i}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Usuarios"}),e.jsxs("button",{onClick:u,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Actualizar"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(De,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Buscar usuarios...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md w-full focus:ring-indigo-500 focus:border-indigo-500",value:p,onChange:x=>g(x.target.value)})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuario"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rol"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Último acceso"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:C.map(x=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.full_name||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:x.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:x.role,onChange:N=>E(x.id,N.target.value),disabled:l.has(x.id),className:`text-sm border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 ${l.has(x.id)?"opacity-50 cursor-not-allowed bg-gray-100":"bg-white hover:bg-gray-50"}`,children:[e.jsx("option",{value:"customer",children:"Cliente"}),e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"fulfillment",children:"Fulfillment"}),e.jsx("option",{value:"dropshipping",children:"Dropshipping"})]}),l.has(x.id)&&e.jsx("div",{className:"absolute inset-y-0 right-8 flex items-center",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-indigo-500 border-t-transparent"})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${x.email_confirmed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:x.email_confirmed?"Verificado":"Pendiente"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x.last_sign_in?new Date(x.last_sign_in).toLocaleDateString():"Nunca"})]},x.id))})]})})]})}function Yt(){const{user:t}=Me(),[r,s]=c.useState([]),[a,i]=c.useState(!0),[m,p]=c.useState("pending"),[g,l]=c.useState(""),[j,u]=c.useState(!1),[E,C]=c.useState([]),[x,N]=c.useState({product_id:"",Name:"",rating:5,comment:"",approved:!0});c.useEffect(()=>{P(),_()},[]);const _=async()=>{try{const{data:f,error:w}=await S.from("products").select("id, name").order("name",{ascending:!0});if(w)throw w;C(f||[]),f&&f.length>0&&N(L=>({...L,product_id:f[0].id}))}catch(f){console.error("Error loading products:",f),y.error("Error al cargar los productos")}},P=async()=>{try{i(!0);const{data:f,error:w}=await S.from("reviews").select(`
          *,
          products (
            name
          )
        `).order("created_at",{ascending:!1});if(w)throw w;s(f||[])}catch(f){console.error("Error loading reviews:",f),y.error("Error al cargar las reseñas")}finally{i(!1)}},d=async f=>{try{const{error:w}=await S.from("reviews").update({approved:!0}).eq("id",f);if(w)throw w;s(L=>L.map(k=>k.id===f?{...k,approved:!0}:k)),y.success("Reseña aprobada")}catch(w){console.error("Error approving review:",w),y.error("Error al aprobar la reseña")}},b=async f=>{try{const{error:w}=await S.from("reviews").update({approved:!1}).eq("id",f);if(w)throw w;s(L=>L.map(k=>k.id===f?{...k,approved:!1}:k)),y.success("Reseña rechazada")}catch(w){console.error("Error rejecting review:",w),y.error("Error al rechazar la reseña")}},T=async f=>{if(confirm("¿Estás seguro de que quieres eliminar esta reseña?"))try{const{error:w}=await S.from("reviews").delete().eq("id",f);if(w)throw w;s(L=>L.filter(k=>k.id!==f)),y.success("Reseña eliminada")}catch(w){console.error("Error deleting review:",w),y.error("Error al eliminar la reseña")}},O=async f=>{var L;if(f.preventDefault(),!t){y.error("Debes estar autenticado para crear reseñas");return}if(!x.product_id){y.error("Debes seleccionar un producto");return}const w=x.Name.trim();if(!w){y.error("Debes ingresar un nombre de usuario");return}if(!x.comment){y.error("Debes ingresar un comentario");return}try{const k={id:crypto.randomUUID(),product_id:x.product_id,user_id:t.id,Name:w,rating:x.rating,comment:x.comment.trim(),approved:x.approved,created_at:new Date().toISOString()};console.log("Enviando datos de reseña:",k);const{error:q}=await S.from("reviews").insert([k]).select();if(q)throw console.error("Error de inserción:",q),q;y.success("Reseña creada con éxito"),N({product_id:((L=E[0])==null?void 0:L.id)||"",Name:"",rating:5,comment:"",approved:!0}),u(!1),await P()}catch(k){console.error("Error creating review:",k),y.error(`Error al crear la reseña: ${k.message||"Intente nuevamente"}`)}},$=r.filter(f=>{var k,q;const w=m==="all"||m==="pending"&&!f.approved||m==="approved"&&f.approved,L=g===""||f.comment.toLowerCase().includes(g.toLowerCase())||((k=f.Name)==null?void 0:k.toLowerCase().includes(g.toLowerCase()))||((q=f.products)==null?void 0:q.name.toLowerCase().includes(g.toLowerCase()));return w&&L});return a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Reseñas"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>u(!j),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(Ce,{className:"h-5 w-5 mr-2"}),"Crear Reseña"]}),e.jsxs("button",{onClick:P,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Actualizar"]})]})]}),j&&e.jsxs("div",{className:"bg-white shadow sm:rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Crear Nueva Reseña"}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"product",className:"block text-sm font-medium text-gray-700",children:"Producto"}),e.jsxs("select",{id:"product",value:x.product_id,onChange:f=>N(w=>({...w,product_id:f.target.value})),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar producto"}),E.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Nombre de Usuario"}),e.jsx("input",{type:"text",id:"username",value:x.Name,onChange:f=>N(w=>({...w,Name:f.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Ej: María López",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Calificación"}),e.jsx("div",{className:"flex items-center mt-1",children:[1,2,3,4,5].map(f=>e.jsx("button",{type:"button",onClick:()=>N(w=>({...w,rating:f})),className:"p-1 focus:outline-none",children:e.jsx(we,{className:`h-6 w-6 ${f<=x.rating?"text-yellow-400":"text-gray-300"}`,fill:"currentColor"})},f))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700",children:"Comentario"}),e.jsx("textarea",{id:"comment",rows:3,value:x.comment,onChange:f=>N(w=>({...w,comment:f.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Escribe un comentario realista sobre el producto...",required:!0})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"approved",type:"checkbox",checked:x.approved,onChange:f=>N(w=>({...w,approved:f.target.checked})),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"approved",className:"ml-2 block text-sm text-gray-900",children:"Aprobar automáticamente"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Crear Reseña"})]})]})]}),e.jsxs("div",{className:"flex space-x-4 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(De,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Buscar reseñas...",value:g,onChange:f=>l(f.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]})}),e.jsxs("select",{value:m,onChange:f=>p(f.target.value),className:"block w-48 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"approved",children:"Aprobadas"}),e.jsx("option",{value:"all",children:"Todas"})]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsxs("ul",{role:"list",className:"divide-y divide-gray-200",children:[$.map(f=>{var w;return e.jsx("li",{className:"px-4 py-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-indigo-600 truncate",children:((w=f.products)==null?void 0:w.name)||"Producto no encontrado"}),e.jsx("div",{className:"ml-2 flex-shrink-0 flex",children:e.jsx("p",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${f.approved?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:f.approved?"Aprobada":"Pendiente"})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex items-center",children:[1,2,3,4,5].map(L=>e.jsx(we,{className:`h-4 w-4 ${L<=f.rating?"text-yellow-400":"text-gray-300"}`,fill:"currentColor"},L))}),e.jsxs("p",{className:"ml-2 text-sm text-gray-500",children:["por ",f.Name||"Usuario anónimo"," "]})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:f.comment}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:me(new Date(f.created_at),"dd/MM/yyyy HH:mm")})]})]}),e.jsxs("div",{className:"ml-6 flex-shrink-0 flex items-center space-x-2",children:[!f.approved&&e.jsx("button",{onClick:()=>d(f.id),className:"p-1 rounded-full text-green-600 hover:bg-green-100",children:e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),f.approved&&e.jsx("button",{onClick:()=>b(f.id),className:"p-1 rounded-full text-yellow-600 hover:bg-yellow-100",children:e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:()=>T(f.id),className:"p-1 rounded-full text-red-600 hover:bg-red-100",children:e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})]})},f.id)}),$.length===0&&e.jsx("li",{className:"px-4 py-8 text-center text-gray-500",children:"No se encontraron reseñas"})]})})]})}function sr(){var l;const t=Be(),[r]=Ge(),{user:s}=Me(),[a,i]=c.useState(r.get("tab")||"orders");if(!s||s.role!=="admin"&&s.role!=="fulfillment")return t("/"),null;const m=[{id:"orders",name:"Pedidos",icon:Ve,component:_e,roles:["admin","fulfillment"]},{id:"products",name:"Productos",icon:Qe,component:dt,roles:["admin"]},{id:"promotions",name:"Promociones",icon:Xe,component:ct,roles:["admin"]},{id:"users",name:"Usuarios",icon:it,component:Jt,roles:["admin"]},{id:"company",name:"Empresa",icon:We,component:mt,roles:["admin"]},{id:"shipping",name:"Envíos",icon:ee,component:Kt,roles:["admin"]},{id:"reviews",name:"Reseñas",icon:at,component:Yt,roles:["admin"]}],p=m.filter(j=>j.roles.includes(s.role)),g=((l=m.find(j=>j.id===a))==null?void 0:l.component)||_e;return e.jsx("div",{className:"min-h-screen bg-gray-100",children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:p.map(j=>e.jsxs("button",{onClick:()=>i(j.id),className:`
                    group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm
                    ${a===j.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                  `,children:[e.jsx(j.icon,{className:`
                      -ml-0.5 mr-2 h-5 w-5
                      ${a===j.id?"text-indigo-500":"text-gray-400 group-hover:text-gray-500"}
                    `}),j.name]},j.id))})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8 py-6",children:e.jsx(g,{})})]})})}export{sr as AdminPanel};
