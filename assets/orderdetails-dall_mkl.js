import{b,d as w,u as _,r as d,s as E,a as P,j as e,L as C,A as k,f as S,C as h,g as L,P as q}from"./index-Bh9ycJS2.js";import{X as g,C as M}from"./x-circle-Ju8FmUhG.js";function F(){var o,m;const{id:i}=b(),p=w(),{user:a}=_(),[r,u]=d.useState(null),[j,l]=d.useState(!0),[n,c]=d.useState(null);d.useEffect(()=>{i&&N()},[i]);const N=async()=>{try{l(!0),c(null);const{data:s,error:t}=await E.from("orders").select(`
          *,
          order_items (
            id,
            quantity,
            price_at_time,
            selected_color,
            products (
              id,
              name,
              images
            )
          )
        `).eq("id",i).single();if(t)throw t;if(!s)throw new Error("Pedido no encontrado");if(s.user_id!==(a==null?void 0:a.id)&&(a==null?void 0:a.role)!=="admin"&&(a==null?void 0:a.role)!=="fulfillment")throw new Error("No tienes permiso para ver este pedido");u(s)}catch(s){console.error("Error loading order:",s),c(s.message||"Error al cargar el pedido"),P.error(s.message||"Error al cargar el pedido")}finally{l(!1)}},f=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=s=>({pending:"Pendiente",processing:"Procesando",shipped:"Enviado",delivered:"Entregado",cancelled:"Cancelado"})[s]||s,v=s=>{switch(s){case"pending":return e.jsx(h,{className:"h-5 w-5"});case"processing":return e.jsx(q,{className:"h-5 w-5"});case"shipped":return e.jsx(L,{className:"h-5 w-5"});case"delivered":return e.jsx(M,{className:"h-5 w-5"});case"cancelled":return e.jsx(g,{className:"h-5 w-5"});default:return e.jsx(h,{className:"h-5 w-5"})}};return j?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})})})}):n||!r?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"mx-auto h-12 w-12 text-red-500"}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Error"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n||"Pedido no encontrado"}),e.jsx("div",{className:"mt-6",children:e.jsx(C,{to:"/orders",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Volver a mis pedidos"})})]})})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("button",{onClick:()=>p(-1),className:"flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(k,{className:"h-5 w-5 mr-2"}),"Volver"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Pedido #",(o=r.id)==null?void 0:o.substring(0,8)]}),e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${f(r.status)}`,children:[v(r.status),e.jsx("span",{className:"ml-2",children:y(r.status)})]})]})}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Información del pedido"}),e.jsxs("dl",{className:"mt-2 text-sm text-gray-900",children:[e.jsxs("div",{className:"mt-1",children:[e.jsx("dt",{className:"inline text-gray-500",children:"Fecha:"}),e.jsx("dd",{className:"inline ml-1",children:S(new Date(r.created_at),"dd/MM/yyyy HH:mm")})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("dt",{className:"inline text-gray-500",children:"Estado del pago:"}),e.jsx("dd",{className:"inline ml-1",children:r.payment_status==="paid"?"Pagado":"Pendiente"})]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("dt",{className:"inline text-gray-500",children:"Método de pago:"}),e.jsx("dd",{className:"inline ml-1",children:r.payment_method==="cash_on_delivery"?"Pago contra entrega":"Mercado Pago"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Dirección de envío"}),e.jsxs("address",{className:"mt-2 text-sm text-gray-900 not-italic",children:[e.jsx("p",{children:r.shipping_address.full_name}),e.jsx("p",{children:r.shipping_address.address}),e.jsxs("p",{children:[r.shipping_address.city,", ",r.shipping_address.postal_code]}),e.jsx("p",{children:r.shipping_address.country}),e.jsxs("p",{children:["Tel: ",r.shipping_address.phone]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-4",children:"Productos"}),e.jsx("div",{className:"divide-y divide-gray-200",children:(m=r.order_items)==null?void 0:m.map((s,t)=>{var x;return e.jsxs("div",{className:"py-4 flex",children:[e.jsx("div",{className:"flex-shrink-0 w-24 h-24",children:((x=s.products.images)==null?void 0:x[0])&&e.jsx("img",{src:s.products.images[0],alt:s.products.name,className:"w-full h-full object-center object-cover rounded-md"})}),e.jsx("div",{className:"ml-4 flex-1",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:s.products.name}),s.selected_color&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Color: ",s.selected_color]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Cantidad: ",s.quantity]})]}),e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["$",(s.price_at_time*s.quantity).toFixed(2)]})]})})]},t)})}),e.jsx("div",{className:"mt-6 border-t border-gray-200 pt-6",children:e.jsxs("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[e.jsx("p",{children:"Total"}),e.jsxs("p",{children:["$",r.total.toFixed(2)]})]})})]})]})]})})}export{F as default};
